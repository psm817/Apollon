<html layout:decorate="~{layout}">
  <div layout:fragment="content">
    <div class="TOP100_container">
      <div class="TOP100_cont_sec">
        <div class="chartList_nav">
          <div class="chartList_nav_sec">
            <div class="chartList_nav_TOP100"><a href="/chart/TOP100">TOP100</a></div>
            <div class="chartList_nav_genreChart"><a href="/chart/genreChart">장르별 차트</a></div>
          </div>
        </div>
        <div class="body_chart_container">
          <span>TOP 100</span>
          <div class="TOP100_body">
            <div class="TOP100_nav">
              <ul>
                <li><span class="TOP100_Rank">순위</span></li>
                <li><span class="Rank_fluctuationRate"></span></li>
                <li><span class="music_thumbnail"></span></li>
                <li><span class="music_title">곡 제목</span></li>
                <li><span class="music_studio">스튜디오</span></li>
                <li><span class="musicLike">좋아요</span></li>
                <li><span class="music_import_myPlayList" th:if="${#authorization.expression('isAuthenticated()')}">담기</span></li>
                <li><span class="music_play">듣기</span></li>
              </ul>
            </div>
            <div class="TOP100_list">
              <ul>
                <!-- 타임리프를 사용하여 musicList라는 변수에 저장된 음악 데이터를 반복하여 출력 -->
                <li class="TOP100_list-num" th:each="music, iterStat : ${musicList}">
                  <span class="TOP100_number" th:text="${iterStat.index + 1}"></span>
                  <div class="TOP100_musicTitle">
                    <div class="thumbImg">
                      <img style="width: 50px;" th:src="@{${music.thumbnailImg}}" alt="썸네일이미지">
                    </div>
                    <div class="classnull"></div>

                    <a th:if="${#authorization.expression('isAuthenticated()')}"
                       class="musicTi"
                       th:href="@{|/chart/music/detail/${music.id}|}">
                      <span th:text="${music.musicTitle}"></span>
                    </a>
                    <a th:if="${#authorization.expression('isAnonymous()')}"
                       class="musicTi"
                       onclick="alert('곡 정보를 확인하려면 로그인이 필요합니다.'); return false;">
                      <span th:text="${music.musicTitle}"></span>
                    </a>

                    <a th:if="${#authorization.expression('isAuthenticated()')}"
                       class="upstu"
                       th:href="@{|/chart/music/detail/${music.id}|}">
                      <span th:text="${music.studio.member.nickname}"></span>
                    </a>
                    <a th:if="${#authorization.expression('isAnonymous()')}"
                       class="upstu"
                       onclick="alert('곡 정보를 확인하려면 로그인이 필요합니다.'); return false;">
                      <span th:text="${music.studio.member.nickname}"></span>
                    </a>
                  </div>
                  <!-- 좋아요 개수 표시 -->
                  <div class="music_likeCount">
                    <span><i class="fa-regular fa-heart"></i></span>
                    <span th:text="${#lists.size(music.musicLikers)}"></span>
                  </div>
                  <!-- 재생목록에 추가 -->
                  <div class="music_imp" th:if="${#authorization.expression('isAuthenticated()')}">
                    <form id="musicForm" method="POST" th:action="@{|/playlist/import/${music.id}|}">
                      <input type="hidden" name="impMusicPlaylist" th:value="${music.id}" />
                      <button type="submit" class="plus-icon" th:if="${#authorization.expression('isAuthenticated()')}">
                        <i class="fa-solid fa-plus"></i>
                      </button>
                    </form>
                  </div>
                  <div class="music_imp" th:if="${#authorization.expression('isAnonymous()')}"></div>
                  <!-- 해당곡 재생하기 -->
                  <div class="music_p">
                    <span><i class="fa-solid fa-play"></i></span>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer_container">
    <div class="footer_play_box">
      <div class="music_myPlayList_box">
        <div class="myPlayList-btn_icon">
          <i class="fa-solid fa-angle-up fa-2x" onclick="togglePlaylist()"></i>
          <i class="fa-solid fa-angle-down fa-2x" onclick="togglePlaylist()"></i>
        </div>
      </div>
      <div class="footer_play_detail">
        <!-- 플레이바 왼쪽 박스 -->
        <div class="footer_play_playBar">
          <!-- 이전 곡, 재생, 이후 곡, 셔플, 반복 -->
          <div class="playSetting">
            <!-- 이전 곡 아이콘 -->
            <div class="growSet BeforeMusic_icon">
              <i class="fa-solid fa-backward-step fa-lg"></i>
            </div>
            <!-- 재생 아이콘 -->
            <div class="growSet playMusic_icon">
              <audio preload="auto" id="audio" controls type="audio/mpeg">
                <!--                <source src="@{${/static/uploadFile/uploadMusics/music.musicMp3}}">-->
              </audio>
              <span class="play" onclick="handlePlay()">
                    <i class="material-icons fa-solid fa-play fa-lg"></i>
                  </span>
            </div>
            <!-- 이후 곡 아이콘 -->
            <div class="growSet afterMusic_icon">
              <i class="fa-solid fa-forward-step fa-lg"></i>
            </div>
            <!-- 셔플 아이콘 -->
            <div class="growSet shuffleMusic_icon">
              <i class="fa-solid fa-shuffle fa-lg" onclick="toggleShuffle()"></i>
            </div>
            <!-- 반복 아이콘 -->
            <div class="growSet loopMusic_icon">
              <div class="btn-box">
                <i class="material-icons fa-solid fa-repeat fa-lg repeat" onclick="handleRepeat()"></i>
              </div>
            </div>
          </div>
        </div>
        <!-- 플레이바 중간 박스 -->
        <div class="footer_play_musicMiddle">
          <div class="musicMiddle_column">
            <!-- 곡 타임라인 -->
            <div class="music_timeLine">
              <div class="timeLine_bar">
                <div class="music-box">
                  <!-- 곡이 재생되고 있는 타이머(?) -->
                  <span class="current-time"></span>
                  <input type="range" step="1" class="seekbar" value="0" min="0" max="100" oninput="handleSeekBar()">
                  <audio class="music-element">
                    <!--                    <source src="${/static/uploadFile/uploadMusics/music.musicMp3}}" type="audio/mp3">-->
                  </audio>
                  <span class="duration"></span>
                </div>
              </div>
            </div>
          </div>
          <!-- 볼륨 -->
          <div class="volume-box">
            <span class="volume-down"><i class="material-icons fa-solid fa-minus fa-lg"></i></span>
            <input type="range" class="volume-range" step="1" value="80" min="0" max="100"
                   oninput="music.volume = this.value/100">
            <span class="volume-up"><i class="material-icons fa-solid fa-plus fa-lg"></i></span>
          </div>
          <div class="btn-box">
            <i class="material-icons fa-solid fa-volume-low fa-lg volume" onclick="handleVolume()"></i>
          </div>
        </div>
        <!-- 플레이바 오른쪽 박스 -->
        <div class="footer_play_musicInformation">
          <!--          <div class="footer_play_musicInfo">-->
          <!--            &lt;!&ndash; 곡 정보 썸네일 이미지 &ndash;&gt;-->
          <!--            <div class="info_thumbnail">-->
          <!--              <div class="info_info_thumbnail_frame">-->
          <!--                &lt;!&ndash;                 <img th:src="@{|${music.thumnailImg}}" alt="">&ndash;&gt;-->
          <!--              </div>-->
          <!--            </div>-->
          <!--            &lt;!&ndash; 곡 정보 제목, 올린 사람 &ndash;&gt;-->
          <!--            <div class="info_box">-->
          <!--              <div class="info_uploadUser">-->
          <!--                <a href="#" th:each="music : ${playlist}" th:text="${music.user}"></a>-->
          <!--              </div>-->
          <!--              <div class="info_musicTitle">-->
          <!--                <a href="#" th:each="music : ${playlist}" th:text="${music.title}"></a>-->
          <!--              </div>-->
          <!--            </div>-->
          <!--          </div>-->
        </div>
      </div>
      <!-- 내 플레이 리스트 보기 -->
      <div class="show_myPlayList" id="myPlayList">
        <div class="show_myPlayList_list">
          <ul>
            <!-- 타임리프를 사용하여 memberMusic 변수에 저장된 음악 데이터를 반복하여 출력 -->
            <li sec:authorize="isAuthenticated()" class="show_myPlayList_list-num"
                th:each="playlist : ${playList}">
              <div class="myPlayList_musicTitle" th:each="music, iterStat : ${playlist.musicPlayList}">
                <div class="number">
                  <span th:text="${iterStat.index + 1}"></span>
                </div>
                <div class="myPlayList-thumbImg">
                  <img th:src="${music.thumbnailImg}" alt="사진 없음">
                </div>
                <a class="myPlayList-musicTi" th:href="@{/chart/music/detail/{id}(id=${music.id})}"
                   th:text="${music.musicTitle}"></a>
                <div class="music_play">
                  <span><i class="fa-solid fa-play"></i></span>
                </div>
              </div>
            </li>
            <li sec:authorize="!isAuthenticated()" class="notLogin_m">
              <span class="notLogin_message">플레이리스트에 음악 추가는 로그인 후 이용가능합니다.<br/><br/>로그인 후 차트목록 메뉴를 통해 음악을 추가해주세요.</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</html>