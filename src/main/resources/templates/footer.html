<nav th:fragment="footerFragment" class="footer">
  <div class="footer_container">
    <div class="footer_play_box">
      <div class="music_myPlayList_box">
        <div class="myPlayList-btn_icon">
          <i class="fa-solid fa-angle-up fa-2x" onclick="togglePlaylist()"></i>
          <i class="fa-solid fa-angle-down fa-2x" onclick="togglePlaylist()"></i>
        </div>
      </div>
      <div class="footer_play_detail">
        <!-- 플레이바 왼쪽 박스 -->
        <div class="footer_play_playBar">
          <!-- 이전 곡, 재생, 이후 곡, 셔플, 반복 -->
          <div class="playSetting">
            <!-- 이전 곡 아이콘 -->
            <div class="growSet BeforeMusic_icon">
              <i class="fa-solid fa-backward-step fa-lg"></i>
            </div>
            <!-- 재생 아이콘 -->
            <div class="growSet playMusic_icon">
              <audio preload="auto" id="audio" controls type="audio/mpeg">
                <!--                <source src="@{${/static/uploadFile/uploadMusics/music.musicMp3}}">-->
              </audio>
              <span class="play" onclick="handlePlay()">
                    <i class="material-icons fa-solid fa-play fa-lg"></i>
                  </span>
            </div>
            <!-- 이후 곡 아이콘 -->
            <div class="growSet afterMusic_icon">
              <i class="fa-solid fa-forward-step fa-lg"></i>
            </div>
            <!-- 셔플 아이콘 -->
            <div class="growSet shuffleMusic_icon">
              <i class="fa-solid fa-shuffle fa-lg" onclick="toggleShuffle()"></i>
            </div>
            <!-- 반복 아이콘 -->
            <div class="growSet loopMusic_icon">
              <div class="btn-box">
                <i class="material-icons fa-solid fa-repeat fa-lg repeat" onclick="handleRepeat()"></i>
              </div>
            </div>
          </div>
        </div>
        <!-- 플레이바 중간 박스 -->
        <div class="footer_play_musicMiddle">
          <div class="musicMiddle_column">
            <!-- 곡 타임라인 -->
            <div class="music_timeLine">
              <div class="timeLine_bar">
                <div class="music-box">
                  <!-- 곡이 재생되고 있는 타이머(?) -->
                  <span class="current-time"></span>
                  <input type="range" step="1" class="seekbar" value="0" min="0" max="100" oninput="handleSeekBar()">
                  <audio class="music-element">
                    <!--                    <source src="${/static/uploadFile/uploadMusics/music.musicMp3}}" type="audio/mp3">-->
                  </audio>
                  <span class="duration"></span>
                </div>
              </div>
            </div>
          </div>
          <!-- 볼륨 -->
          <div class="volume-box">
            <span class="volume-down"><i class="material-icons fa-solid fa-minus fa-lg"></i></span>
            <input type="range" class="volume-range" step="1" value="80" min="0" max="100"
                   oninput="music.volume = this.value/100">
            <span class="volume-up"><i class="material-icons fa-solid fa-plus fa-lg"></i></span>
          </div>
          <div class="btn-box">
            <i class="material-icons fa-solid fa-volume-low fa-lg volume" onclick="handleVolume()"></i>
          </div>
        </div>
        <!-- 플레이바 오른쪽 박스 -->
        <div class="footer_play_musicInformation">
<!--          <div class="footer_play_musicInfo">-->
<!--            &lt;!&ndash; 곡 정보 썸네일 이미지 &ndash;&gt;-->
<!--            <div class="info_thumbnail">-->
<!--              <div class="info_info_thumbnail_frame">-->
<!--                &lt;!&ndash;                 <img th:src="@{|${music.thumnailImg}}" alt="">&ndash;&gt;-->
<!--              </div>-->
<!--            </div>-->
<!--            &lt;!&ndash; 곡 정보 제목, 올린 사람 &ndash;&gt;-->
<!--            <div class="info_box">-->
<!--              <div class="info_uploadUser">-->
<!--                <a href="#" th:each="music : ${playlist}" th:text="${music.user}"></a>-->
<!--              </div>-->
<!--              <div class="info_musicTitle">-->
<!--                <a href="#" th:each="music : ${playlist}" th:text="${music.title}"></a>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
        </div>
      </div>
      <!-- 내 플레이 리스트 보기 -->
      <div class="show_myPlayList" id="myPlayList">
        <div class="show_myPlayList_list">
          <ul>
            <!-- 타임리프를 사용하여 memberMusic 변수에 저장된 음악 데이터를 반복하여 출력 -->
            <li sec:authorize="isAuthenticated()" class="show_myPlayList_list-num"
                th:each="playlist : ${playList}">
              <div class="myPlayList_musicTitle" th:each="music, iterStat : ${playlist.musicPlayList}">
                <div class="number">
                  <span th:text="${iterStat.index + 1}"></span>
                </div>
                <div class="myPlayList-thumbImg">
                  <img th:src="${music.thumbnailImg}" alt="사진 없음">
                </div>
                <a class="myPlayList-musicTi" th:href="@{/chart/music/detail/{id}(id=${music.id})}"
                   th:text="${music.musicTitle}"></a>
                <div class="music_play">
                  <span><i class="fa-solid fa-play"></i></span>
                </div>
              </div>
            </li>
            <li sec:authorize="!isAuthenticated()" class="notLogin_m">
              <span class="notLogin_message">플레이리스트에 음악 추가는 로그인 후 이용가능합니다.<br/><br/>로그인 후 차트목록 메뉴를 통해 음악을 추가해주세요.</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- 재생목록 표출시 html, css로 구현 가능한데 코드가 길어져서 자바스크립트 추가 -->
  <script>
    var audio = new Audio(); // 오디오 객체 생성
    var currentTrackId = null; // 현재 재생 중인 트랙 ID

    var music = document.querySelector('.music-element')
    var playBtn = document.querySelector('.play')
    var seekbar = document.querySelector('.seekbar')
    var currentTime = document.querySelector('.current-time')
    var duration = document.querySelector('.duration')


    // 재생목록 열기/닫기
    function togglePlaylist() {
      var footerContainer = document.querySelector('.footer_container');
      var upIcon = document.querySelector('.fa-angle-up');
      var downIcon = document.querySelector('.fa-angle-down');
      var showMyPlayList = document.querySelector('.show_myPlayList');

      if (footerContainer.classList.contains('open')) {
        upIcon.style.display = 'block';
        downIcon.style.display = 'none';
        showMyPlayList.style.display = 'none';
      } else {
        upIcon.style.display = 'none';
        downIcon.style.display = 'block';
        showMyPlayList.style.display = 'block';
      }
      footerContainer.classList.toggle('open');
    }
    // 셔플
    function toggleShuffle() {
      var shuffleIcon = document.querySelector('.fa-shuffle');
      if (!isShuffle) {
        shuffleIcon.style.color = 'orange'; // 연한 보라색으로 변경
        shuffle(playlist);
      } else {
        shuffleIcon.style.color = 'white'; // 원래 색상으로 변경
        // 이전에 재배치된 순서로 재생되도록 하는 코드를 여기에 추가
      }
      isShuffle = !isShuffle; // 셔플 상태를 토글
    }

    // 반복
    var repIcon = document.querySelector('.repeat')
    function handleRepeat() {
        if (music.loop == true) {
            music.loop = false
            repIcon.style.color = 'white'
            repIcon.classList.toggle('active')
        }
        else {
            music.loop = true
            repIcon.style.color = 'skyblue'
            repIcon.classList.toggle('active')
        }
    }

    // 볼륨 조절
    var volIcon = document.querySelector('.volume')
    var volBox = document.querySelector('.volume-box')
    var volumeRange = document.querySelector('.volume-range')
    var volumeDown = document.querySelector('.volume-down')
    var volumeUp = document.querySelector('.volume-up')

    function handleVolume() {
        volIcon.classList.toggle('active')
        volBox.classList.toggle('active')
    }

    volumeDown.addEventListener('click', handleVolumeDown);
    volumeUp.addEventListener('click', handleVolumeUp);

    function handleVolumeDown() {
        volumeRange.value = Number(volumeRange.value) - 20
        music.volume = volumeRange.value / 100
    }
    function handleVolumeUp() {
        volumeRange.value = Number(volumeRange.value) + 20
        music.volume = volumeRange.value / 100
    }


    // 재생, 일시정지
    function handlePlay() {
        if (music.paused) {
            music.play();
            playBtn.className = 'pause'
            playBtn.innerHTML = '<i class="material-icons fa-solid fa-pause fa-lg"></i>'
        } else {
            music.pause();
            playBtn.className = 'play'
            playBtn.innerHTML = '<i class="material-icons fa-solid fa-play fa-lg"></i>'
        }
        music.addEventListener('ended', function () {
            playBtn.className = 'play'
            playBtn.innerHTML = '<i class="material-icons fa-solid fa-play fa-lg"></i>'
            music.currentTime = 0
        });
    }

    music.onloadeddata = function () {
        seekbar.max = music.duration
        var ds = parseInt(music.duration % 60)
        var dm = parseInt((music.duration / 60) % 60)
        duration.innerHTML = dm + ':' + ds
    }
    music.ontimeupdate = function () { seekbar.value = music.currentTime }
    handleSeekBar = function () { music.currentTime = seekbar.value }
    music.addEventListener('timeupdate', function () {
        var cs = parseInt(music.currentTime % 60)
        var cm = parseInt((music.currentTime / 60) % 60)
        currentTime.innerHTML = cm + ':' + cs
    }, false)

    // 이전곡, 이후곡

  </script>
</nav>