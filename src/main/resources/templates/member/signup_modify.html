<html layout:decorate="~{layout}">
<div layout:fragment="content" class="box">
    <div class="container">
        <div class="welcome-box">
            <span th:text="'í”„ë¡œí•„ ìˆ˜ì •ì„ ì§„í–‰ì¤‘ì…ë‹ˆë‹¤... ğŸ¤©'"></span>
        </div>
        <div class="signup-form">
            <div class="input-box">
                <form th:action="@{|/member/modify/${member.username}|}" method="POST" onsubmit="submitWriteForm(this); return false;" enctype="multipart/form-data">
                    <div class="id-box">
                        <span class="font-weight">ID</span>
                        <div class="chk-id">
                            <input type="text" id="username" maxlength="20" name="username" th:placeholder="${member.username}" th:disabled="true">
                        </div>
                    </div>
                    <div class="password-box">
                        <span>ë¹„ë°€ë²ˆí˜¸</span>
                        <input type="password" name="password" maxlength="20" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.">
                    </div>
                    <div class="password-confirm-box">
                        <span>ë¹„ë°€ë²ˆí˜¸ í™•ì¸</span>
                        <input type="password" name="password_confirm" maxlength="20" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ í•œë²ˆ ë” ì…ë ¥í•˜ì„¸ìš”.">
                    </div>
                    <div class="nickname-box">
                        <div class="nickname-info">
                            <span>ë‹‰ë„¤ì„</span>
                            <span>(â€» ë“±ë¡í•˜ì‹  ë‹‰ë„¤ì„ì€ ìŠ¤íŠœë””ì˜¤ ì´ë¦„ê³¼ ì¼ì¹˜í•©ë‹ˆë‹¤.)</span>
                        </div>
                        <input type="text" name="nickname" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”.">
                    </div>
                    <div class="email-box">
                        <span>ì´ë©”ì¼</span>
                        <input type="email" name="email" th:placeholder="${member.email}">
                    </div>
                    <div class="profile-picture-box">
                        <span>í”„ë¡œí•„ ì‚¬ì§„</span>
                        <input type="file" name="profilePicture" onchange="imagecheck()">

                    </div>
                    <div class="signup-btn">
                        <button type="button" onclick="if(confirm('í”„ë¡œí•„ ìˆ˜ì •ì„ ê·¸ë§Œë‘ì‹œê² ìŠµë‹ˆê¹Œ?')) { window.location.href='/member/myPage'; }">ì·¨ì†Œ</button>
                        <button type="submit" onclick="confirm('í”„ë¡œí•„ ìˆ˜ì •ì„ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ? \ní”„ë¡œí•„ ìˆ˜ì •ì´ ì™„ë£Œë˜ë©´ ì¬ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');" id="submitButton">ìˆ˜ì •</button>
                        <img id="profilePicturePreview" src="#" alt="í”„ë¡œí•„ ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°" style="display: none; max-width: 260px; max-height: 2600px;">
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</html>

<script>
    function validateForm() {
        const signupError = document.getElementById("signupError");
        const submitButton = document.getElementById("submitButton");
        const usernameInput = document.getElementById("username");
        // Get the value of the username input field
        const username = usernameInput.value.trim();
        // Check if the username is not empty
        if (username !== "") {
            // Send an AJAX request to the server to check for duplicate username
            fetch("/member/check-username?username=" + username)
                .then(response => response.json())
                .then(data => {
                    if (data.exists) {
                        signupError.innerText = "(ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.)";
                        signupError.classList.remove("success");
                        signupError.classList.add("error");
                        submitButton.disabled = true;
                    } else {
                        signupError.innerText = "(ì…ë ¥í•˜ì‹  ì•„ì´ë””ëŠ” ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.)";
                        signupError.classList.remove("error");
                        signupError.classList.add("success");
                        submitButton.disabled = false;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    }
    document.addEventListener("DOMContentLoaded", function() {
        validateForm();
        document.querySelector('input[type="file"]').addEventListener('change', function () {
            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('profilePicturePreview').src = e.target.result;
                document.getElementById('profilePicturePreview').style.display = 'block';
            };
            reader.readAsDataURL(this.files[0]);
        });
    });

    function submitWriteForm(form) {
        form.password.value = form.password.value.trim();

        if ( form.password.value.length == 0 ) {
            alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            form.password.focus();
            return;
        }

        form.password_confirm.value = form.password_confirm.value.trim();

        if ( form.password_confirm.value.length == 0 ) {
            alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
            form.password_confirm.focus();
            return;
        }

        form.nickname.value = form.nickname.value.trim();

        if ( form.nickname.value.length == 0 ) {
            alert("ë‹‰ë„¤ì„(ìŠ¤íŠœë””ì˜¤ ì´ë¦„)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            form.nickname.focus();
            return;
        }

        form.email.value = form.email.value.trim();

        if ( form.email.value.length == 0 ) {
            alert("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            form.email.focus();
            return;
        }

        form.profilePicture.value = form.profilePicture.value.trim();

        if ( form.profilePicture.value.length == 0 ) {
            alert("í”„ë¡œí•„ ì‚¬ì§„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
            form.profilePicture.focus();
            return;
        }

        form.submit();
    }
</script>